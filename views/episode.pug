html
  head
    title=data.show_name
    script.
      window.HELP_IMPROVE_VIDEOJS = false;
    meta(name='viewport', content='width=device-width, initial-scale=1')
    link(rel='stylesheet', href='https://vjs.zencdn.net/7.8.4/video-js.css')
    style(type='text/css').
      .video-js .vjs-text-track-display > div > div > div {
        font-size: 0.75em !important; 
        font-weight: 300 !important;
        text-shadow:
          -1px -1px 0 #000,
           0   -1px 0 #000,
           1px -1px 0 #000,
           1px  0   0 #000,
           1px  1px 0 #000,
           0    1px 0 #000,
          -1px  1px 0 #000,
          -1px  0   0 #000;
      	background:transparent !important;
      }
      .limit{
        max-height:75vmin
      }

  include header.pug
  body
    - video_src = '/prod-data/videos/'+encodeURIComponent(data.show_name)+'/'+encodeURIComponent(data.file_name)
    - subtitle_src = '/prod-data/videos/'+encodeURIComponent(data.show_name)+'/'+encodeURIComponent(data.file_name.substring(0,data.file_name.lastIndexOf('.')+1)+'vtt')
    video(align="center" id="my-video" class="px-3 mt-3 limit video-js vjs-default-skin vjs-big-play-centered vjs-fluid" controls preload="auto" playsinline)
      source(src=video_src, type='video/mp4')
      track(srclang="en" label="English" src=subtitle_src default)
    script(src='https://vjs.zencdn.net/7.8.4/video.min.js')
    script.
      !function(e,n){"object"==typeof exports&&"undefined"!=typeof module?module.exports=n(require("video.js"),require("global/window")):"function"==typeof define&&define.amd?define(["video.js","global/window"],n):(e="undefined"!=typeof globalThis?globalThis:e||self).videojsLandscapeFullscreen=n(e.videojs,e.window)}(this,(function(e,n){"use strict";function t(e){return e&&"object"==typeof e&&"default"in e?e:{default:e}}var o=t(e),i=t(n),l={fullscreen:{enterOnRotate:!0,alwaysInLandscapeMode:!0,iOS:!0}},r=i.default.screen;r.lockOrientationUniversal=function(e){return r.orientation&&r.orientation.lock(e).then((function(){}),(function(e){return console.log(e)}))||r.mozLockOrientation&&r.mozLockOrientation(e)||r.msLockOrientation&&r.msLockOrientation(e)};var a=function(){return"number"==typeof i.default.orientation||r&&r.orientation&&r.orientation.angle?i.default.orientation:(o.default.log("angle unknown"),0)},s=o.default.registerPlugin||o.default.plugin,u=function(e){var n=this;(o.default.browser.IS_ANDROID||o.default.browser.IS_IOS)&&this.ready((function(){!function(e,n){e.addClass("vjs-landscape-fullscreen"),n.fullscreen.iOS&&o.default.browser.IS_IOS&&o.default.browser.IOS_VERSION>9&&!e.el_.ownerDocument.querySelector(".bc-iframe")&&(e.tech_.el_.setAttribute("playsinline","playsinline"),e.tech_.supportsFullScreen=function(){return!1});var t=function(){var n=a();90!==n&&270!==n&&-90!==n||!1===e.paused()&&(e.requestFullscreen(),r.lockOrientationUniversal("landscape")),0!==n&&180!==n||e.isFullscreen()&&e.exitFullscreen()};o.default.browser.IS_IOS?i.default.addEventListener("orientationchange",t):r&&r.orientation&&(r.orientation.onchange=t),e.on("fullscreenchange",(function(t){(o.default.browser.IS_ANDROID||o.default.browser.IS_IOS)&&!a()&&e.isFullscreen()&&n.fullscreen.alwaysInLandscapeMode&&r.lockOrientationUniversal("landscape")}))}(n,o.default.mergeOptions(l,e))}))};return s("landscapeFullscreen",u),u.VERSION="11.1.0",fetch("https://cdn.jsdelivr.net/npm/videojs-landscape-fullscreen@11.1.0/dist/videojs-landscape-fullscreen.min.js"),u}));

    script.
      var player = videojs('my-video',{
          userActions: {
            doubleClick: false
          },
        }
      );
      window.player = player
      document.getElementById("my-video").addEventListener('click', function (event) {
        if(event.detail == 2){
          window.player.requestFullscreen();
        }
      });
      player.responsive(true);
      player.landscapeFullscreen();
      window.lastClick = 0
      document.getElementById("my-video").addEventListener('touchstart', function (event) {
        const curtime = (new Date()).getTime()
        if(curtime-window.lastClick<250){
          if(event.touches.length>1){
            window.player.pause()
          }
          else{
            const width = document.getElementById("my-video").offsetWidth
            const x = event.touches[0].clientX
            if(x > width*(0.5+0.125)){
              window.player.currentTime(window.player.currentTime()+10)
            }
            else if(x < width*(0.5-0.125)){
              window.player.currentTime(window.player.currentTime()-10)
            }
            else
              window.player.pause()

          }
          window.lastClick = 0
        }
        else
          window.lastClick = curtime
      });

      
    div(class="m-3")
      h2= data.show_name
        img(src='/media/icon-chan.png' class="header-icon" style="border-radius: 50%" width="30em")
      h3= "Episode "+data.episode
      a(href=video_src) Download Link
      p(id="output")
